import * as tslib_1 from "tslib";
import { NgModule, Injectable, Inject } from '@angular/core';
import { Router, NavigationEnd } from '@angular/router';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/router';
function _window() {
    return window;
}
var WindowRef = /** @class */ (function () {
    function WindowRef() {
    }
    Object.defineProperty(WindowRef.prototype, "nativeWindow", {
        get: function () {
            return _window();
        },
        enumerable: true,
        configurable: true
    });
WindowRef.ɵfac = function WindowRef_Factory(t) { return new (t || WindowRef)(); };
WindowRef.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: WindowRef, factory: function (t) { return WindowRef.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowRef, [{
        type: Injectable
    }], function () { return []; }, null); })();
    return WindowRef;
}());
export { WindowRef };
var BackButtonDisableModule = /** @class */ (function () {
    function BackButtonDisableModule(router, windowRef, preserveScrollPosition) {
        this.router = router;
        this.windowRef = windowRef;
        this.preserveScrollPosition = preserveScrollPosition;
        this.scrollX = 0;
        this.scrollY = 0;
        this.window = this.windowRef.nativeWindow;
        this.disableBackButton();
        this.addPopStateEventListener();
    }
    BackButtonDisableModule_1 = BackButtonDisableModule;
    BackButtonDisableModule.forRoot = function (config) {
        return {
            ngModule: BackButtonDisableModule_1,
            providers: [
                {
                    provide: 'preserveScrollPosition',
                    useValue: config && 'preserveScrollPosition' in config ? config.preserveScrollPosition : false
                }
            ]
        };
    };
    BackButtonDisableModule.prototype.addPopStateEventListener = function () {
        var _this = this;
        this.window.addEventListener('popstate', function () {
            if (_this.preserveScrollPosition)
                _this.getScrollCoordinates();
            _this.window.history.pushState(null, null, null);
            if (_this.preserveScrollPosition)
                setTimeout(_this.scrollToThePreviousPosition.bind(_this));
        });
    };
    BackButtonDisableModule.prototype.scrollToThePreviousPosition = function () {
        this.window.scrollTo(this.scrollX, this.scrollY);
    };
    BackButtonDisableModule.prototype.getScrollCoordinates = function () {
        this.scrollX = this.window.scrollX;
        this.scrollY = this.window.scrollY;
    };
    BackButtonDisableModule.prototype.disableBackButton = function () {
        var _this = this;
        this.window.history.pushState(null, null, null);
        this.router.events.subscribe(function (event) {
            if (event instanceof NavigationEnd) {
                _this.window.history.pushState(null, null, null);
            }
            ;
        });
    };
    var BackButtonDisableModule_1;
    BackButtonDisableModule.ctorParameters = function () { return [
        { type: Router },
        { type: WindowRef },
        { type: Boolean, decorators: [{ type: Inject, args: ['preserveScrollPosition',] }] }
    ]; };
    BackButtonDisableModule = BackButtonDisableModule_1 = tslib_1.__decorate([ tslib_1.__param(2, Inject('preserveScrollPosition'))
    ], BackButtonDisableModule);
BackButtonDisableModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: BackButtonDisableModule });
BackButtonDisableModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function BackButtonDisableModule_Factory(t) { return new (t || BackButtonDisableModule)(ɵngcc0.ɵɵinject(ɵngcc1.Router), ɵngcc0.ɵɵinject(WindowRef), ɵngcc0.ɵɵinject('preserveScrollPosition')); }, providers: [WindowRef] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(BackButtonDisableModule, [{
        type: NgModule,
        args: [{
                providers: [WindowRef]
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: WindowRef }, { type: Boolean, decorators: [{
                type: Inject,
                args: ['preserveScrollPosition']
            }] }]; }, null); })();
    return BackButtonDisableModule;
}());
export { BackButtonDisableModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVibGljX2FwaS5qcyIsInNvdXJjZXMiOlsibmc6L2FuZ3VsYXItZGlzYWJsZS1icm93c2VyLWJhY2stYnV0dG9uL3B1YmxpY19hcGkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUF1QixNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7O0FBRXhELFNBQVMsT0FBTztBQUFLLElBQ25CLE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFHRDtBQUNvQixJQURwQjtBQUF1QixJQUl2QixDQUFDO0FBQ0QsSUFKRSxzQkFBSSxtQ0FBWTtBQUFJLGFBQXBCO0FBQWMsWUFDWixPQUFPLE9BQU8sRUFBRSxDQUFDO0FBQ3JCLFFBQUUsQ0FBQztBQUNGO0FBR1c7QUFFRCxPQU5SO0lBSFUsU0FBUyxnQ0FEckIsVUFBVSxFQUFFLFFBQ0EsU0FBUyxDQUlyQjs7OztnREFDRDtBQUNBLElBRkEsZ0JBQUM7QUFFRCxDQUZDLEFBSkQsSUFJQztBQUNELFNBTGEsU0FBUztBQVN0QjtBQUVtQixJQUlqQixpQ0FDVSxNQUFjLEVBQ2QsU0FBb0IsRUFDYyxzQkFBK0I7QUFDMUUsUUFIUyxXQUFNLEdBQU4sTUFBTSxDQUFRO0FBQUMsUUFDZixjQUFTLEdBQVQsU0FBUyxDQUFXO0FBQUMsUUFDYSwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQVM7QUFDN0UsUUFQVSxZQUFPLEdBQUcsQ0FBQyxDQUFDO0FBQ3RCLFFBQVUsWUFBTyxHQUFHLENBQUMsQ0FBQztBQUN0QixRQU1JLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUE7QUFDN0MsUUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztBQUM3QixRQUFJLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO0FBQ3BDLElBQUUsQ0FBQztBQUNILGdDQWZhLHVCQUF1QjtBQUFFLElBZ0I3QiwrQkFBTyxHQUFkLFVBQWUsTUFBNEM7QUFBSSxRQUM3RCxPQUFPO0FBQ1gsWUFBTSxRQUFRLEVBQUUseUJBQXVCO0FBQ3ZDLFlBQU0sU0FBUyxFQUFFO0FBQ2pCLGdCQUFRO0FBQ1Isb0JBQVUsT0FBTyxFQUFFLHdCQUF3QjtBQUMzQyxvQkFBVSxRQUFRLEVBQUUsTUFBTSxJQUFJLHdCQUF3QixJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxLQUFLO0FBQ3hHLGlCQUFTO0FBQ1QsYUFBTztBQUNQLFNBQUssQ0FBQTtBQUNMLElBQUUsQ0FBQztBQUVILElBQVUsMERBQXdCLEdBQWhDO0FBQWMsUUFBZCxpQkFNQztBQUNILFFBTkksSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUU7QUFDdkMsWUFBQSxJQUFJLEtBQUksQ0FBQyxzQkFBc0I7QUFBRSxnQkFBQSxLQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztBQUNuRSxZQUFNLEtBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3RELFlBQU0sSUFBSSxLQUFJLENBQUMsc0JBQXNCO0FBQUUsZ0JBQUEsVUFBVSxDQUFDLEtBQUksQ0FBQywyQkFBMkIsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLENBQUMsQ0FBQztBQUMvRixRQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ1AsSUFBRSxDQUFDO0FBRUgsSUFBVSw2REFBMkIsR0FBbkM7QUFBYyxRQUNaLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3JELElBQUUsQ0FBQztBQUVILElBQVUsc0RBQW9CLEdBQTVCO0FBQWMsUUFDWixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO0FBQ3ZDLFFBQUksSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUN2QyxJQUFFLENBQUM7QUFFSCxJQUFVLG1EQUFpQixHQUF6QjtBQUFjLFFBQWQsaUJBT0M7QUFDSCxRQVBJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3BELFFBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFVBQUEsS0FBSztBQUFJLFlBQ3BDLElBQUksS0FBSyxZQUFZLGFBQWEsRUFBRTtBQUMxQyxnQkFBUSxLQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUN4RCxhQUFPO0FBQUMsWUFBRCxDQUFDO0FBQ1IsUUFBSSxDQUFDLENBQUMsQ0FBQztBQUNQLElBQUUsQ0FBQztBQUNGO0FBQ2lDO0FBQW9FLGdCQS9DbEYsTUFBTTtBQUN4QixnQkFBcUIsU0FBUztBQUM5Qiw4Q0FBRyxNQUFNLFNBQUMsd0JBQXdCO0FBQVE7QUFBVSxJQVR6Qyx1QkFBdUIsNERBSG5DLFFBQVEsQ0FBQyxjQUNSLFNBQVMsRUFBRSxDQUFDLFNBQVMsckRBRWYsQ0FTSCxtQkFBQSxNQUFNLENBQUMsd0JBQXdCLENBQUMsQ0FBQTtBQVhiLFVBQ3ZCLENBQUMsWEFVb0MsT0FUekIsdUJBQXVCLENBcURuQzs7Ozs7Ozs7Ozs7a0NBQ0Q7QUFBQyxJQURELDhCQUFDO0FBQ0EsQ0FEQSxBQXJERCxJQXFEQztBQUNELFNBdERhLHVCQUF1QjtBQUVwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nTW9kdWxlLCBJbmplY3RhYmxlLCBNb2R1bGVXaXRoUHJvdmlkZXJzLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciwgTmF2aWdhdGlvbkVuZCB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5cbmZ1bmN0aW9uIF93aW5kb3coKTogYW55IHtcbiAgcmV0dXJuIHdpbmRvdztcbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFdpbmRvd1JlZiB7XG4gIGdldCBuYXRpdmVXaW5kb3coKTogYW55IHtcbiAgICByZXR1cm4gX3dpbmRvdygpO1xuICB9XG59XG5cbkBOZ01vZHVsZSh7XG4gIHByb3ZpZGVyczogW1dpbmRvd1JlZl1cbn0pXG5leHBvcnQgY2xhc3MgQmFja0J1dHRvbkRpc2FibGVNb2R1bGUge1xuXG4gIHByaXZhdGUgd2luZG93OiBXaW5kb3c7XG4gIHByaXZhdGUgc2Nyb2xsWCA9IDA7XG4gIHByaXZhdGUgc2Nyb2xsWSA9IDA7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIHdpbmRvd1JlZjogV2luZG93UmVmLFxuICAgIEBJbmplY3QoJ3ByZXNlcnZlU2Nyb2xsUG9zaXRpb24nKSBwcml2YXRlIHByZXNlcnZlU2Nyb2xsUG9zaXRpb246IGJvb2xlYW5cbiAgKSB7XG4gICAgdGhpcy53aW5kb3cgPSB0aGlzLndpbmRvd1JlZi5uYXRpdmVXaW5kb3dcbiAgICB0aGlzLmRpc2FibGVCYWNrQnV0dG9uKCk7XG4gICAgdGhpcy5hZGRQb3BTdGF0ZUV2ZW50TGlzdGVuZXIoKTtcbiAgfVxuXG4gIHN0YXRpYyBmb3JSb290KGNvbmZpZz86IHsgcHJlc2VydmVTY3JvbGxQb3NpdGlvbjogYm9vbGVhbiB9KTogTW9kdWxlV2l0aFByb3ZpZGVycyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5nTW9kdWxlOiBCYWNrQnV0dG9uRGlzYWJsZU1vZHVsZSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogJ3ByZXNlcnZlU2Nyb2xsUG9zaXRpb24nLFxuICAgICAgICAgIHVzZVZhbHVlOiBjb25maWcgJiYgJ3ByZXNlcnZlU2Nyb2xsUG9zaXRpb24nIGluIGNvbmZpZyA/IGNvbmZpZy5wcmVzZXJ2ZVNjcm9sbFBvc2l0aW9uIDogZmFsc2VcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkUG9wU3RhdGVFdmVudExpc3RlbmVyKCk6IHZvaWQge1xuICAgIHRoaXMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMucHJlc2VydmVTY3JvbGxQb3NpdGlvbikgdGhpcy5nZXRTY3JvbGxDb29yZGluYXRlcygpO1xuICAgICAgdGhpcy53aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgbnVsbCwgbnVsbCk7XG4gICAgICBpZiAodGhpcy5wcmVzZXJ2ZVNjcm9sbFBvc2l0aW9uKSBzZXRUaW1lb3V0KHRoaXMuc2Nyb2xsVG9UaGVQcmV2aW91c1Bvc2l0aW9uLmJpbmQodGhpcykpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzY3JvbGxUb1RoZVByZXZpb3VzUG9zaXRpb24oKTogdm9pZCB7XG4gICAgdGhpcy53aW5kb3cuc2Nyb2xsVG8odGhpcy5zY3JvbGxYLCB0aGlzLnNjcm9sbFkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTY3JvbGxDb29yZGluYXRlcygpOiB2b2lkIHtcbiAgICB0aGlzLnNjcm9sbFggPSB0aGlzLndpbmRvdy5zY3JvbGxYO1xuICAgIHRoaXMuc2Nyb2xsWSA9IHRoaXMud2luZG93LnNjcm9sbFk7XG4gIH1cblxuICBwcml2YXRlIGRpc2FibGVCYWNrQnV0dG9uKCk6IHZvaWQge1xuICAgIHRoaXMud2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKG51bGwsIG51bGwsIG51bGwpO1xuICAgIHRoaXMucm91dGVyLmV2ZW50cy5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCkge1xuICAgICAgICB0aGlzLndpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShudWxsLCBudWxsLCBudWxsKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==